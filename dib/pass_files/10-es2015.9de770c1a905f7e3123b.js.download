(window.webpackJsonp=window.webpackJsonp||[]).push([[10],{"/hRe":function(t,e,a){"use strict";a.d(e,"d",function(){return K}),a.d(e,"a",function(){return o}),a.d(e,"b",function(){return F}),a.d(e,"c",function(){return L});var r,o,n,i=a("SVse"),s=a("tqRt"),c=a("7bNT");!function(t){let e;!function(t){t.CLOSED="CLOSED",t.IN_PROGRESS="IN_PROGRESS"}(e=t.Status||(t.Status={})),t.TRANSACTION_FEATURE_KEY="transaction"}(r||(r={})),(n=o||(o={})).loadVirtualKeyboard=Object(s.n)("[Transaction Factor] Load Virtual Keyboard",Object(s.s)()),n.virtualKeyboardLoaded=Object(s.n)("[Transaction Factor] Virtual Keyboard Loaded",Object(s.s)()),n.changeIdentifier=Object(s.n)("[Transaction Factor] Change Identifier"),n.cancel=Object(s.n)("[Transaction Factor] Cancel",Object(s.s)()),n.support=Object(s.n)("[Transaction Factor] Support");const d={status:r.Status.CLOSED},u=Object(s.p)(d,Object(s.r)(o.loadVirtualKeyboard,t=>Object.assign(Object.assign({},t),{virtualKeyboardMedia:void 0})),Object(s.r)(o.virtualKeyboardLoaded,(t,{virtualKeyboardMedia:e})=>((t,e)=>Object.assign(Object.assign({},t),{virtualKeyboardMedia:e}))(t,e)));var b=a("TAw0"),l=a("LRne"),p=a("cp0P"),O=a("bOdf"),h=a("zp1y"),g=a("eIep"),j=a("JIr8"),f=a("lJxs"),v=a("r5qd"),y=a("8Y7J");let S=(()=>{class t{constructor(t){this.dacsFacade=t}loadVirtualKeyboardStructure(t){return this.dacsFacade.loadVirtualKeyboardStructure(t)}loadVirtualKeyboardMedium(t,e){var a;return Object(p.a)([this.dacsFacade.loadVirtualKeyboardResource(t.uri,!0),!0===e?this.dacsFacade.loadVirtualKeyboardResource(null!==(a=t.sndUri)&&void 0!==a?a:"",!0):Object(l.a)("")]).pipe(Object(f.a)(([e,a])=>Object.assign(Object.assign({},t),{imageData:e,soundData:a})))}}return t.\u0275fac=function(e){return new(e||t)(y.Zb(v.a.Facade))},t.\u0275prov=y.Lb({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();var T=a("l4CP"),C=a("8OQc");let E=(()=>{class t{constructor(t,e,a){this.actions$=t,this.store$=e,this.transactionService=a,this.loadVirtualKeyboard$=Object(c.c)(()=>this.actions$.pipe(Object(c.d)(o.loadVirtualKeyboard),Object(O.a)(t=>Object(l.a)(t).pipe(Object(h.a)(this.store$.pipe(Object(s.t)(b.d.getFunctionalExceptionCode)),this.store$.pipe(Object(s.t)(C.b.a11yToggleStatus))))),Object(g.a)(([{url:t},e,a])=>b.f.inconsistentConfirmPasswordException===e?[]:this.transactionService.loadVirtualKeyboardStructure(null!=t?t:"").pipe(Object(g.a)(t=>this.getVirtualKeyboardWithData(t,a)),Object(j.a)(t=>Object(l.a)(b.c.throwTechnicalException({code:T.a.TransactionStateExceptionsEnum.RequestFailed,message:"Impossible de charger le clavier virtuel",location:"FactorEffects",cause:t})))))))}getVirtualKeyboardWithData(t,e){const a=t.map(t=>this.transactionService.loadVirtualKeyboardMedium(t,e));return Object(p.a)(a).pipe(Object(f.a)(t=>{if(t.every(t=>!!t.imageData))return o.virtualKeyboardLoaded({virtualKeyboardMedia:t});throw new b.b("Impossible to get image data",T.a.TransactionStateExceptionsEnum.RequestFailed)}),Object(j.a)(t=>Object(l.a)(b.c.throwTechnicalException({code:T.a.TransactionStateExceptionsEnum.RequestFailed,message:"Impossible to get virtual keyboard",cause:t}))))}}return t.\u0275fac=function(e){return new(e||t)(y.Zb(c.a),y.Zb(s.h),y.Zb(S))},t.\u0275prov=y.Lb({token:t,factory:t.\u0275fac}),t})();var F,m=a("vkgz"),w=a("pLZG");(F||(F={})).postMessage=Object(s.n)("[Transaction Post Message] Post Message",Object(s.s)());var R=a("tsXU"),A=a("lxlh");let I=(()=>{class t{constructor(t){this.actions$=t,this.postMessage$=Object(c.c)(()=>this.actions$.pipe(Object(c.d)(F.postMessage),Object(m.a)(t=>{if(null!==document.referrer){const e=document.referrer.match("^(https?:\\/\\/[^\\/]*).*"),a=1;e&&e.length>=a&&window.parent&&window.parent.postMessage(Object.assign(Object.assign({},t.postMessage),{key:"SecurityAccess"}),e[a])}})),{dispatch:!1}),this.virtualKeyboardLoaded$=Object(c.c)(()=>this.actions$.pipe(Object(c.d)(o.virtualKeyboardLoaded),Object(f.a)(()=>F.postMessage({postMessage:{event:"VirtualKeyboardDisplayed"}})))),this.onError$=Object(c.c)(()=>this.actions$.pipe(Object(c.d)(b.c.throwTechnicalException),Object(f.a)(()=>F.postMessage({postMessage:{event:"ErrorDisplayed"}})))),this.passwordRenewed$=Object(c.c)(()=>this.actions$.pipe(Object(c.d)(A.a.goTo),Object(w.a)(t=>t.direction===A.b.RENEW_CONFIRMATION),Object(f.a)(()=>F.postMessage({postMessage:{event:"OperationSucceeded"}})))),this.displayRenewConfirmationMessage$=Object(c.c)(()=>this.actions$.pipe(Object(c.d)(A.a.goTo),Object(w.a)(t=>t.direction===A.b.RENEW_CONFIRMATION),Object(f.a)(()=>F.postMessage({postMessage:{event:"ConfirmationMessageDisplayed"}}))))}}return t.\u0275fac=function(e){return new(e||t)(y.Zb(c.a))},t.\u0275prov=y.Lb({token:t,factory:t.\u0275fac}),t})();function M(t,e){return function(t,e){return u(t,e)}(t,e)}let K=(()=>{class t{}return t.\u0275mod=y.Nb({type:t}),t.\u0275inj=y.Mb({factory:function(e){return new(e||t)},imports:[[i.c,s.j.forFeature(r.TRANSACTION_FEATURE_KEY,M),c.b.forFeature([E,I])]]}),t})();var N;(N||(N={})).fallback=Object(s.n)("[Transaction] Fallback");var L,P,V,x=a("o3hk");(P=L||(L={})).getState=Object(s.o)(r.TRANSACTION_FEATURE_KEY),P.getTransactionContext=Object(s.q)(P.getState,t=>t.context),P.getAuthenticationTransactionContext=Object(s.q)(P.getTransactionContext,t=>{if(t&&x.a.isAuthenticationTransactionContext(t))return t}),P.getRenewTransactionContext=Object(s.q)(P.getTransactionContext,t=>{if(t&&x.a.isRenewTransactionContext(t))return t}),P.getTransactionId=Object(s.q)(P.getState,t=>{var e;return null!==(e=sessionStorage.getItem("transactionId"))&&void 0!==e?e:void 0}),P.getPhase=Object(s.q)(P.getState,t=>t.phase),P.getFactor=Object(s.q)(P.getState,t=>sessionStorage.getItem("factor")?JSON.parse(sessionStorage.getItem("factor")):void 0),P.getPhoneNumberOfSmsFactor=Object(s.q)(P.getState,t=>{const e=t&&t.factor?t.factor:void 0;return e&&e.validationUnits&&e.validationUnits[0]&&e.validationUnits[0][t.factor.validationUnitId]&&e.validationUnits[0][t.factor.validationUnitId][0]&&e.validationUnits[0][t.factor.validationUnitId][0].phoneNumber?e.validationUnits[0][t.factor.validationUnitId][0].phoneNumber:void 0}),P.isCancelableFactorInIntegratedMode=Object(s.q)(P.getState,t=>t.factor&&v.a.FactorType.PASSWORD!==t.factor.factorType),P.getVirtualKeyboardElements=Object(s.q)(P.getState,t=>null==t?void 0:t.virtualKeyboardMedia),P.getToken=Object(s.q)(P.getState,t=>t.token),P.hasFallbackEnabled=Object(s.q)(P.getPhase,t=>!(!t||!R.a.isAuthenticationPhase(t))&&t.fallbackFactorAvailable),function(t){let e;!function(t){t.VALID="VALID",t.CANCEL="CANCEL",t.TIMEOUT="TIMEOUT",t.ERROR="ERROR",t.FALLBACK="FALLBACK"}(e=t.ReasonType||(t.ReasonType={})),t.startPollingCloudCardStatus=Object(s.n)("[Authentication CloudCard Factor] Start Polling CloudCard"),t.stopPollingCloudCardStatus=Object(s.n)("[Authentication CloudCard Factor] Stop Polling CloudCard",Object(s.s)()),t.validateCloudCardFactor=Object(s.n)("[Authentication Cloudcard Factor] Validate Cloudcard Factor")}(V||(V={}))},"u/qi":function(t,e,a){"use strict";a.r(e),a.d(e,"AuthenticationModule",function(){return A});var r=a("SVse"),o=a("iInd"),n=a("quSY"),i=a("itXk"),s=a("LRne"),c=a("tqRt"),d=a("henM"),u=a("oXLI"),b=a("IzEk"),l=a("5+tZ"),p=a("JIr8"),O=a("o3hk"),h=a("lxlh"),g=a("BRvO"),j=a("Yp3Q"),f=a("lFKG"),v=a("TAw0"),y=a("l4CP"),S=a("r5qd"),T=a("OVZf"),C=a("8Y7J");let E=(()=>{class t{constructor(t,e,a,r,o,i){this.gatewayFacade=t,this.store=e,this.transactionService=a,this.factorService=r,this.applicationStorageFacade=o,this.authenticationFailService=i,this.subscription=new n.a}ngOnInit(){this.subscription=Object(i.b)([this.store.pipe(Object(c.t)(d.b.getIdentificationData)),this.store.pipe(Object(c.t)(u.c.getContextConfiguration)),this.store.pipe(Object(c.t)(u.c.isEntMobileNavigation))]).pipe(Object(b.a)(1),Object(l.a)(([t,e,a])=>this.startTransaction(t,e,a,null==e?void 0:e.isUAMobile)),Object(p.a)(t=>this.manageAuthenticationDoneError(t))).subscribe(t=>{if(!t)throw new Error("Le facteur n'a pas pu \xeatre r\xe9cup\xe9r\xe9 \xe0 partir de la transaction");f.a.factor=t,this.factorService.displayFactor()},t=>{let e="Une erreur s'est produite";throw t.error&&t.error.hasOwnProperty("error_description")&&(e=t.error.error_description),new v.b(`${e} : ${JSON.stringify(t,["status","url","message"])}`,y.a.AppError.RequestFailed)})}ngOnDestroy(){this.subscription.unsubscribe()}startTransaction(t,e,a,r){if(e){const o=this.gatewayFacade.buildTransactionContext(e,t);return f.a.serviceType=o.serviceType,this.applicationStorageFacade.updateEntityCode(o.entityCode||""),this.transactionService.startTransaction(e,o,a,r)}throw new Error("Le context de configuration n'est pas d\xe9fini (Auth ou renew)")}manageAuthenticationDoneError(t){if(S.b.isApiValidationResponseWithAuthenticationDone(t)){if(t.response.saml2_post&&this.authenticationFailService.checkNoPluginError(t.response.status,t.response.saml2_post.samlResponse))return this.store.dispatch(h.a.goTo({direction:h.b.NO_PLUGIN_LOCKED})),Object(s.a)();throw new Error("unknownApiResponse")}throw t}}return t.\u0275fac=function(e){return new(e||t)(C.Pb(O.a.Facade),C.Pb(c.h),C.Pb(j.a),C.Pb(g.a),C.Pb(f.b),C.Pb(T.a))},t.\u0275cmp=C.Jb({type:t,selectors:[["as-transaction"]],decls:0,vars:0,template:function(t,e){},encapsulation:2}),t})();const F=[{path:"",data:{trackingKey:a("9Gas").c.PageNameType.NO_TRACKING},component:E}];let m=(()=>{class t{}return t.\u0275mod=C.Nb({type:t}),t.\u0275inj=C.Mb({factory:function(e){return new(e||t)},imports:[[o.g.forChild(F)],o.g]}),t})();var w=a("/hRe"),R=a("7+mf");let A=(()=>{class t{}return t.\u0275mod=C.Nb({type:t}),t.\u0275inj=C.Mb({factory:function(e){return new(e||t)},imports:[[r.c,m,w.d,R.LoaderModule]]}),t})()}}]);